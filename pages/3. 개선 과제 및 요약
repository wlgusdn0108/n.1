import streamlit as st
import pandas as pd

st.set_page_config(page_title="3. ê°œì„  ê³¼ì œ ë° ìš”ì•½", layout="centered")

CSV_FILE = "esg_data.csv"

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
try:
    df = pd.read_csv(CSV_FILE)
except FileNotFoundError:
    st.error(f"âš ï¸ ë°ì´í„° íŒŒì¼ '{CSV_FILE}' ì´(ê°€) ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê°™ì€ í´ë”ì— CSV íŒŒì¼ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.")
    st.stop()

def get_grade(score):
    if score >= 80:
        return "A (ìš°ìˆ˜)"
    elif score >= 60:
        return "B (ë³´í†µ)"
    elif score >= 40:
        return "C (ì£¼ì˜)"
    else:
        return "D (ìœ„í—˜)"

# ìµœì‹  ë°ì´í„°
latest = df.iloc[-1]

# ìŠ¤íƒ€ì¼ë§
st.markdown("""
<style>
.big-title {
    font-size: 50px;
    font-weight: bold;
    color: #B03A2E;
    text-align: center;
    margin-bottom: 30px;
}
.subtitle {
    font-size: 22px;
    color: #873600;
    text-align: center;
    margin-bottom: 40px;
}
.improvement {
    font-size: 20px;
    margin-bottom: 15px;
}
.grade {
    font-size: 24px;
    font-weight: bold;
    margin: 10px 0;
}
</style>
""", unsafe_allow_html=True)

st.markdown('<div class="big-title">ğŸ› ï¸ 3. ê°œì„  ê³¼ì œ ë° ìš”ì•½</div>', unsafe_allow_html=True)
st.markdown('<div class="subtitle">ìµœê·¼ ESG ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì£¼ìš” ê°œì„  ê³¼ì œì™€ ë“±ê¸‰ì„ ìš”ì•½í•©ë‹ˆë‹¤.</div>', unsafe_allow_html=True)

# ê°œì„  ê³¼ì œ ë„ì¶œ
improvements = []
if latest["ESG_Environmental"] < 60:
    improvements.append("âœ” **í™˜ê²½(E)**: íƒ„ì†Œ ê°ì¶•, ì¹œí™˜ê²½ ì„¤ë¹„ ë„ì… í•„ìš”")
if latest["ESG_Social"] < 60:
    improvements.append("âœ” **ì‚¬íšŒ(S)**: ì§ì› ë§Œì¡±ë„ ì œê³ , ì§€ì—­ì‚¬íšŒ í™œë™ ê°•í™” í•„ìš”")
if latest["ESG_Governance"] < 60:
    improvements.append("âœ” **ì§€ë°°êµ¬ì¡°(G)**: íˆ¬ëª…ê²½ì˜, ì´ì‚¬íšŒ ë‹¤ì–‘ì„± í™•ëŒ€ í•„ìš”")

# ê°œì„  ê³¼ì œ ì¶œë ¥
st.subheader("ğŸ” ê°œì„  ê³¼ì œ")
if improvements:
    for imp in improvements:
        st.markdown(f'<div class="improvement">{imp}</div>', unsafe_allow_html=True)
else:
    st.success("ëª¨ë“  ESG í•­ëª©ì´ ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ğŸ‰")

# ë“±ê¸‰ ìš”ì•½
st.subheader("ğŸ“Š ìµœì‹  ESG ë“±ê¸‰ ìš”ì•½")
st.markdown(f"""
- **í™˜ê²½ (E)**: <span class="grade">{get_grade(latest['ESG_Environmental'])}</span>  
- **ì‚¬íšŒ (S)**: <span class="grade">{get_grade(latest['ESG_Social'])}</span>  
- **ì§€ë°°êµ¬ì¡° (G)**: <span class="grade">{get_grade(latest['ESG_Governance'])}</span>  
- **ì¢…í•© ESG**: <span class="grade">{get_grade(latest['ESG_Overall'])}</span>  
""", unsafe_allow_html=True)

st.markdown("---")
st.markdown("> ğŸ’¡ ESG ë“±ê¸‰ê³¼ ê°œì„  ê³¼ì œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§€ì†ê°€ëŠ¥ì„± ì „ëµì„ êµ¬ì²´í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
